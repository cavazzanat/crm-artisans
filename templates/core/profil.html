<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil entreprise ‚Äì CRM Artisans</title>
  {% load static %}
  <link rel="icon" type="image/png" href="{% static 'core/image/favicon.png' %}">
  
  <style>
    :root{
      --bg: #f8fafc;
      --card: #ffffff;
      --muted: #64748b;
      --text: #1e293b;
      --primary: #6366f1;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --accent: #8b5cf6;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0,0,0,.08), 0 1px 2px rgba(0,0,0,.04);
      --ring: rgba(99,102,241,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding-bottom: 3rem;
    }

    /* Header identique au reste de l'app */
    .header{
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: saturate(180%) blur(8px);
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.85));
      border-bottom: 1px solid var(--border);
      box-shadow: 0 1px 2px rgba(0,0,0,.05);
    }
    .header-inner{
      max-width: 1280px;
      margin: 0 auto;
      padding: .85rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      justify-content: space-between;
    }
    .brand{
      display: flex;
      align-items: center;
      gap: .75rem;
      font-weight: 700;
      letter-spacing: .2px;
      color: var(--text);
    }
    .logo{
      width: 34px;
      height: 34px;
      border-radius: 10px;
      background: linear-gradient(145deg, var(--primary), var(--accent));
      box-shadow: var(--shadow);
      display: grid;
      place-items: center;
    }
    .logo svg{ width: 18px; height: 18px; color: white }

    .nav{
      display: flex;
      gap: .25rem;
      align-items: center;
    }
    .nav a{
      text-decoration: none;
      color: var(--muted);
      padding: .55rem .8rem;
      border-radius: 10px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    .nav a:hover{
      color: var(--text);
      background: rgba(148,163,184,.08);
      border-color: var(--border);
    }
    .nav a.active{ 
      color: white;
      background: rgba(99,102,241,.18);
      border-color: rgba(99,102,241,.35);
      box-shadow: 0 0 0 2px var(--ring);
    }

    .user{
      display: flex;
      align-items: center;
      gap: .75rem;
      color: var(--muted);
      font-size: .95rem;
    }
    .user form button{
      background: none;
      border: none;
      color: var(--muted);
      cursor: pointer;
      text-decoration: underline;
      font: inherit;
      padding: 0;
    }
    .user form button:hover{ color: var(--text); }

    /* Layout */
    .container{ max-width: 900px; margin: 2rem auto; padding: 0 1rem }
    .page-title{ font-size: 1.8rem; font-weight: 800; margin-bottom: .5rem }
    .subtitle{ color: var(--muted); margin-bottom: 1.75rem; font-size: .95rem }

    /* Sections */
    .section{
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }
    .section-header{
      display: flex;
      align-items: center;
      gap: .75rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.25rem;
    }
    .section-title{
      font-size: 1.05rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: .6rem;
    }

    /* Forms */
    .form-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem;
    }
    .form-group{
      display: flex;
      flex-direction: column;
      gap: .5rem;
    }
    .form-group.full{ grid-column: 1/-1 }
    
    .form-group label{
      color: var(--text);
      font-size: .9rem;
      font-weight: 600;
    }
    .required::after{
      content: ' *';
      color: var(--danger);
    }

    .input, .select, .textarea{
      width: 100%;
      padding: .65rem .8rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: white;
      color: var(--text);
      font: inherit;
      transition: all 0.2s ease;
    }
    .textarea{
      resize: vertical;
      min-height: 100px;
    }
    .input::placeholder, .textarea::placeholder{
      color: var(--muted);
      opacity: .6;
    }
    .input:focus, .select:focus, .textarea:focus{
      outline: none;
      box-shadow: 0 0 0 3px rgba(99,102,241,.1);
      border-color: var(--primary);
    }

    .help-text{
      font-size: .85rem;
      color: var(--muted);
      margin-top: -.25rem;
    }

    /* Alerts */
    .alert{
      padding: .85rem 1rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      border: 1px solid;
      display: flex;
      align-items: center;
      gap: .6rem;
    }
    .alert.warning{
      background: #fef3c7;
      color: #92400e;
      border-color: #fde68a;
    }
    .alert.success{
      background: #d1fae5;
      color: #065f46;
      border-color: #a7f3d0;
    }
    .alert.info{
      background: #dbeafe;
      color: #1e40af;
      border-color: #bfdbfe;
    }

    /* Actions */
    .form-actions{
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      margin-top: 1.5rem;
    }
    .btn{
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .6rem .9rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
      color: var(--text);
      text-decoration: none;
      cursor: pointer;
      font: inherit;
      transition: all 0.2s ease;
      font-weight: 500;
    }
    .btn:hover{
      background: #f8fafc;
      border-color: #cbd5e1;
      transform: translateY(-1px);
    }
    .btn.primary{
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    .btn.primary:hover{
      background: #4f46e5;
    }

    @media (max-width: 640px){
      .form-actions{
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M4 14.5 12 4l8 10.5-8 5.5-8-5.5Z" stroke="currentColor" stroke-width="1.6"/>
          </svg>
        </div>
        <span>manay</span>
      </div>
      <nav class="nav">
        <a href="{% url 'dashboard' %}">Accueil</a>
        <a href="{% url 'operations' %}">Op√©rations</a>
        <a href="{% url 'clients' %}">Clients</a>
        <a href="{% url 'profil' %}" class="active">Profil</a>
      </nav>
      <div class="user">
        <span>{{ user.username }}</span>
        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit">D√©connexion</button>
        </form>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="container">
    <h1 class="page-title">‚öôÔ∏è Profil entreprise</h1>
    <p class="subtitle">
      Renseignez les informations essentielles pour g√©n√©rer des devis professionnels.
    </p>

    <!-- Alerte profil incomplet -->
    {% if not profil.est_complet %}
    <div class="alert warning">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M12 9v4m0 4h.01M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z" stroke="currentColor" stroke-width="2"/>
      </svg>
      <div>
        <strong>Profil incomplet</strong><br>
        Compl√©tez les champs obligatoires (*) pour activer la g√©n√©ration de devis.
      </div>
    </div>
    {% endif %}

    <!-- Messages -->
    {% if messages %}
      {% for message in messages %}
      <div class="alert {{ message.tags }}">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="m5 12 4 4 10-10" stroke="currentColor" stroke-width="2"/>
        </svg>
        {{ message }}
      </div>
      {% endfor %}
    {% endif %}

    <form method="POST">
      {% csrf_token %}

      <!-- 1. Identification entreprise -->
      <section class="section">
        <div class="section-header">
          <div class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M3 21V8a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v11" stroke="currentColor" stroke-width="2"/>
            </svg>
            1. Identification entreprise
          </div>
        </div>
        
        <div class="form-grid">
          <div class="form-group full">
            <label class="required" for="nom_entreprise">Nom / Raison sociale</label>
            <input class="input" 
                   type="text" 
                   id="nom_entreprise" 
                   name="nom_entreprise" 
                   value="{{ profil.nom_entreprise }}" 
                   placeholder="Ex: Plomberie Dupont"
                   required>
          </div>
          
          <div class="form-group">
            <label class="required" for="siret">N¬∞ SIRET (14 chiffres)</label>
            <input class="input" 
                   type="text" 
                   id="siret" 
                   name="siret" 
                   value="{{ profil.siret }}" 
                   maxlength="14"
                   placeholder="12345678900012"
                   required>
          </div>
          
          <div class="form-group">
            <label for="forme_juridique">Forme juridique (optionnel)</label>
            <select class="select" id="forme_juridique" name="forme_juridique">
              <option value="">‚Äî S√©lectionner ‚Äî</option>
              {% for value, label in formes_juridiques %}
              <option value="{{ value }}" {% if profil.forme_juridique == value %}selected{% endif %}>
                {{ label }}
              </option>
              {% endfor %}
            </select>
          </div>
        </div>
      </section>

      <!-- 2. Adresse -->
      <section class="section">
        <div class="section-header">
          <div class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M12 21s-6-4.35-6-9a6 6 0 1 1 12 0c0 4.65-6 9-6 9Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            2. Adresse du si√®ge
          </div>
        </div>
        
        <div class="form-grid">
          <div class="form-group full">
            <label class="required" for="adresse">Adresse compl√®te</label>
            <textarea class="textarea" 
                      id="adresse" 
                      name="adresse" 
                      rows="2"
                      placeholder="Ex: 15 rue de la Paix"
                      required>{{ profil.adresse }}</textarea>
          </div>
          
          <div class="form-group">
            <label class="required" for="code_postal">Code postal</label>
            <input class="input" 
                   type="text" 
                   id="code_postal" 
                   name="code_postal" 
                   value="{{ profil.code_postal }}"
                   placeholder="75010"
                   required>
          </div>
          
          <div class="form-group">
            <label class="required" for="ville">Ville</label>
            <input class="input" 
                   type="text" 
                   id="ville" 
                   name="ville" 
                   value="{{ profil.ville }}"
                   placeholder="Paris"
                   required>
          </div>
        </div>
      </section>

      <!-- 3. Coordonn√©es professionnelles -->
      <section class="section">
        <div class="section-header">
          <div class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2.12 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.9.3 1.77.54 2.63a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.45-1.11a2 2 0 0 1 2.11-.45c.86.24 1.73.42 2.63.54A2 2 0 0 1 22 16.92Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            3. Coordonn√©es professionnelles
          </div>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label class="required" for="telephone">T√©l√©phone</label>
            <input class="input" 
                   type="tel" 
                   id="telephone" 
                   name="telephone" 
                   value="{{ profil.telephone }}"
                   placeholder="01 23 45 67 89"
                   required>
          </div>
          
          <div class="form-group">
            <label class="required" for="email">Email professionnel</label>
            <input class="input" 
                   type="email" 
                   id="email" 
                   name="email" 
                   value="{{ profil.email }}"
                   placeholder="contact@entreprise.fr"
                   required>
          </div>
          
          <div class="form-group full">
            <label for="site_web">Site web (optionnel)</label>
            <input class="input" 
                   type="url" 
                   id="site_web" 
                   name="site_web" 
                   value="{{ profil.site_web }}"
                   placeholder="https://www.monentreprise.fr">
          </div>
        </div>
      </section>

      <!-- 4. Mentions l√©gales du devis -->
      <section class="section">
        <div class="section-header">
          <div class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M8 2h8a2 2 0 0 1 2 2v16l-6-3-6 3V4a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            4. Mentions l√©gales du devis
          </div>
        </div>
        
        <div class="form-group full">
          <label for="mentions_legales_devis">Conditions et mentions (optionnel)</label>
          <textarea class="textarea" 
                    id="mentions_legales_devis" 
                    name="mentions_legales_devis" 
                    rows="4"
                    placeholder="Ex: Devis valable 30 jours. Paiement comptant ou en 3 fois. P√©nalit√©s de retard : 10% du montant HT.">{{ profil.mentions_legales_devis }}</textarea>
          <small class="help-text">
            üí° Ces mentions appara√Ætront en bas de vos devis (conditions de paiement, d√©lais, etc.)
          </small>
        </div>
      </section>

      <!-- Actions -->
      <div class="form-actions">
        <a href="{% url 'dashboard' %}" class="btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2"/>
          </svg>
          Annuler
        </a>
        <button type="submit" class="btn primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="m5 12 4 4 10-10" stroke="currentColor" stroke-width="2"/>
          </svg>
          üíæ Enregistrer le profil
        </button>
      </div>
    </form>
  </main>
</body>
</html>