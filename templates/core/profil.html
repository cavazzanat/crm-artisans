<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil entreprise ‚Äì CRM Artisans</title>
  <style>
    :root{
      --bg: #0b1220;
      --card: #0f172a;
      --muted: #94a3b8;
      --text: #e2e8f0;
      --primary: #6366f1;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --accent: #8b5cf6;
      --ring: rgba(99,102,241,.35);
      --border: rgba(148,163,184,.15);
      --shadow: 0 10px 25px rgba(2,6,23,.3), 0 1px 0 rgba(255,255,255,.03) inset;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial;
      background: radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.12), transparent 40%),
                  radial-gradient(1000px 600px at 80% 10%, rgba(139,92,246,.12), transparent 40%),
                  var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* Header / Nav ‚Äì repris de "Nouvelle Op√©ration" */
    .header{ position: sticky; top: 0; z-index: 40; backdrop-filter: saturate(180%) blur(8px); background: linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,.65)); border-bottom: 1px solid var(--border) }
    .header-inner{ max-width:1280px; margin:0 auto; padding:.85rem 1rem; display:flex; align-items:center; gap:1rem; justify-content:space-between }
    .brand{ display:flex; align-items:center; gap:.75rem; font-weight:700; letter-spacing:.2px }
    .logo{ width:34px; height:34px; border-radius:10px; background:linear-gradient(145deg, var(--primary), var(--accent)); box-shadow: var(--shadow); display:grid; place-items:center }
    .logo svg{ width:18px; height:18px; color:white }
    .nav{ display:flex; gap:.25rem; align-items:center }
    .nav a{ text-decoration:none; color:var(--muted); padding:.55rem .8rem; border-radius:10px; border:1px solid transparent }
    .nav a:hover{ color:var(--text); background:rgba(148,163,184,.08); border-color:var(--border) }
    .nav a.active{ color:white; background:rgba(99,102,241,.18); border-color: rgba(99,102,241,.35); box-shadow: 0 0 0 2px var(--ring) }
    .user{ display:flex; align-items:center; gap:.75rem; color:var(--muted); font-size:.95rem }
    .user button{ background:none; border:none; color:var(--muted); cursor:pointer; text-decoration:underline; font:inherit }

    /* Layout */
    .container{ max-width:1000px; margin: 2rem auto; padding: 0 1rem }
    .page-title{ font-size: clamp(1.4rem, 2.4vw, 2rem); font-weight:800; letter-spacing:.2px; margin-bottom: .25rem }
    .page-sub{ color:var(--muted); margin-bottom: 1.25rem }

    /* Cards/Sections */
    .section{ background: linear-gradient(180deg, rgba(2,6,23,.6), rgba(2,6,23,.4)); border:1px solid var(--border); border-radius:16px; padding:1.25rem; box-shadow: var(--shadow); margin-bottom:1.25rem }
    .section-header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:.4rem .35rem .75rem; border-bottom:1px dashed var(--border); margin-bottom:1rem }
    .section-title{ display:flex; gap:.6rem; align-items:center; font-size:1.05rem; font-weight:700 }
    .section-subtitle{ color:var(--muted); font-size:.85rem; margin-top:.3rem; font-weight:400 }

    /* Forms */
    .form-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:1rem }
    .form-group{ display:flex; flex-direction:column; gap:.4rem; margin-bottom: .25rem }
    .form-group.full{ grid-column: 1/-1 }
    .form-group label{ color:var(--muted); font-size:.9rem; font-weight:600 }
    .required::after{ content: ' *'; color: var(--danger) }

    .input, .select, .textarea{ width:100%; padding:.65rem .8rem; border-radius:10px; border:1px solid var(--border); background: rgba(2,6,23,.35); color: var(--text); font:inherit }
    .textarea{ resize:vertical; min-height:92px }
    .input::placeholder{ color: rgba(226,232,240,.55) }
    .input:focus, .select:focus, .textarea:focus{ outline:none; box-shadow: 0 0 0 2px var(--ring); border-color: rgba(99,102,241,.35) }

    /* Alerts */
    .alert{ padding: .8rem 1rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid; display: flex; align-items: center; gap: .6rem }
    .alert.warning{ color:#92400e; background: rgba(245,158,11,.12); border-color: rgba(245,158,11,.35) }
    .alert.success{ color: var(--success); background: rgba(34,197,94,.1); border-color: rgba(34,197,94,.2) }
    .alert.error{ color: var(--danger); background: rgba(239,68,68,.1); border-color: rgba(239,68,68,.2) }

    /* Logo */
    .logo-preview{ margin:.25rem 0 1rem }
    .logo-preview img{ max-width:220px; border:1px solid var(--border); border-radius:10px; padding:.5rem; background: rgba(148,163,184,.06) }

    /* Actions */
    .form-actions{ background: rgba(148,163,184,.03); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; display: flex; justify-content: space-between; align-items: center; margin-top: 1.25rem }
    .btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.6rem .9rem; border-radius:10px; border:1px solid var(--border); background:rgba(148,163,184,.07); color:var(--text); text-decoration:none; cursor:pointer; font:inherit; transition: all 0.2s ease; font-weight: 500 }
    .btn:hover{ background:rgba(148,163,184,.12); transform: translateY(-1px) }
    .btn.primary{ background:linear-gradient(180deg, rgba(99,102,241,.18), rgba(99,102,241,.12)); border-color: rgba(99,102,241,.35); color: white }
    .btn.secondary{ background:rgba(148,163,184,.05) }

    @media (max-width: 780px){
      .form-actions{ flex-direction: column; gap: 1rem; align-items: stretch }
    }

    @media (prefers-color-scheme: light){
      :root{ --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --muted: #64748b; --border: rgba(30,41,59,.12); --shadow: 0 10px 25px rgba(30,41,59,.08), 0 1px 0 rgba(255,255,255,.8) inset }
      body{ background: radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.05), transparent 40%), radial-gradient(1000px 600px at 80% 10%, rgba(139,92,246,.05), transparent 40%), var(--bg) }
      .header{ background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.8)); backdrop-filter: saturate(180%) blur(8px) }
      .section{ background: var(--card); border: 1px solid var(--border); box-shadow: var(--shadow) }
      .input, .select, .textarea{ background: #fff; border-color: var(--border); color: var(--text) }
      .nav a.active{ color: var(--primary); background: rgba(99,102,241,.08); border-color: rgba(99,102,241,.2) }
    }
  </style>
</head>
<body>
  <!-- Header / Nav identique -->
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M4 14.5 12 4l8 10.5-8 5.5-8-5.5Z" stroke="currentColor" stroke-width="1.6"/>
          </svg>
        </div>
        <span>CRM Artisans</span>
      </div>
      <nav class="nav">
        <a href="{% url 'dashboard' %}">Accueil</a>
        <a href="{% url 'operations' %}">Op√©rations</a>
        <a href="{% url 'clients' %}">Clients</a>
        <a href="{% url 'profil' %}" class="active">Profil</a>
      </nav>
      <div class="user">
        <span>{{ user.username }}</span>
        <form method="post" action="{% url 'logout' %}" style="display:inline">
          {% csrf_token %}
          <button type="submit">D√©connexion</button>
        </form>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="page-title">‚öôÔ∏è Profil entreprise</h1>
    <p class="page-sub">Renseignez les informations de votre entreprise pour g√©n√©rer des devis et factures professionnels (PDF).</p>

    {% if not profil.est_complet %}
    <div class="alert warning">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 9v4m0 4h.01M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z" stroke="currentColor" stroke-width="1.6"/></svg>
      <strong>Profil incomplet :</strong> compl√©tez les champs obligatoires pour activer les documents officiels.
    </div>
    {% endif %}

    {% if messages %}
      {% for message in messages %}
      <div class="alert {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- Identification entreprise -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 21V8a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v11" stroke="currentColor" stroke-width="1.6"/></svg>
            1. Identification de l'entreprise
          </h2>
          <div class="section-subtitle">Raison sociale, SIRET, TVA‚Ä¶</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="required" for="nom_entreprise">Nom / Raison sociale</label>
            <input class="input" type="text" id="nom_entreprise" name="nom_entreprise" value="{{ profil.nom_entreprise }}" required>
          </div>
          <div class="form-group">
            <label for="forme_juridique">Forme juridique</label>
            <select class="select" id="forme_juridique" name="forme_juridique">
              <option value="">‚Äî S√©lectionner ‚Äî</option>
              {% for value, label in formes_juridiques %}
              <option value="{{ value }}" {% if profil.forme_juridique == value %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label class="required" for="siret">N¬∞ SIRET</label>
            <input class="input" type="text" id="siret" name="siret" value="{{ profil.siret }}" maxlength="14" placeholder="12345678900012" required>
          </div>
          <div class="form-group">
            <label for="code_ape">Code APE/NAF</label>
            <input class="input" type="text" id="code_ape" name="code_ape" value="{{ profil.code_ape }}" placeholder="4332A">
          </div>
          <div class="form-group">
            <label for="rcs">N¬∞ RCS + Ville</label>
            <input class="input" type="text" id="rcs" name="rcs" value="{{ profil.rcs }}" placeholder="RCS Paris 123 456 789">
          </div>
          <div class="form-group">
            <label for="capital_social">Capital social (‚Ç¨)</label>
            <input class="input" type="number" step="0.01" id="capital_social" name="capital_social" value="{{ profil.capital_social|default:'' }}" placeholder="5000">
          </div>
          <div class="form-group full">
            <label for="tva_intracommunautaire">N¬∞ TVA intracommunautaire</label>
            <input class="input" type="text" id="tva_intracommunautaire" name="tva_intracommunautaire" value="{{ profil.tva_intracommunautaire }}" placeholder="FR12345678901">
          </div>
        </div>
      </section>

      <!-- Adresse -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 21s-6-4.35-6-9a6 6 0 1 1 12 0c0 4.65-6 9-6 9Z" stroke="currentColor" stroke-width="1.6"/></svg>
            2. Adresse du si√®ge
          </h2>
        </div>
        <div class="form-grid">
          <div class="form-group full">
            <label class="required" for="adresse">Adresse</label>
            <textarea class="textarea" id="adresse" name="adresse" rows="2" required>{{ profil.adresse }}</textarea>
          </div>
          <div class="form-group">
            <label for="code_postal">Code postal</label>
            <input class="input" type="text" id="code_postal" name="code_postal" value="{{ profil.code_postal }}" placeholder="75010">
          </div>
          <div class="form-group">
            <label for="ville">Ville</label>
            <input class="input" type="text" id="ville" name="ville" value="{{ profil.ville }}" placeholder="Paris">
          </div>
        </div>
      </section>

      <!-- Coordonn√©es -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2.12 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.9.3 1.77.54 2.63a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.45-1.11a2 2 0 0 1 2.11-.45c.86.24 1.73.42 2.63.54A2 2 0 0 1 22 16.92Z" stroke="currentColor" stroke-width="1.6"/></svg>
            3. Coordonn√©es professionnelles
          </h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="required" for="telephone">T√©l√©phone</label>
            <input class="input" type="tel" id="telephone" name="telephone" value="{{ profil.telephone }}" placeholder="01 23 45 67 89" required>
          </div>
          <div class="form-group">
            <label class="required" for="email">Email</label>
            <input class="input" type="email" id="email" name="email" value="{{ profil.email }}" placeholder="contact@entreprise.fr" required>
          </div>
          <div class="form-group full">
            <label for="site_web">Site web</label>
            <input class="input" type="url" id="site_web" name="site_web" value="{{ profil.site_web }}" placeholder="https://www.monentreprise.fr">
          </div>
        </div>
      </section>

      <!-- Assurance d√©cennale -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z" stroke="currentColor" stroke-width="1.6"/></svg>
            4. Assurance d√©cennale
          </h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label for="assurance_decennale_nom">Nom de l'assureur</label>
            <input class="input" type="text" id="assurance_decennale_nom" name="assurance_decennale_nom" value="{{ profil.assurance_decennale_nom }}" placeholder="AXA, Allianz, MAAF">
          </div>
          <div class="form-group">
            <label for="assurance_decennale_numero">N¬∞ de police</label>
            <input class="input" type="text" id="assurance_decennale_numero" name="assurance_decennale_numero" value="{{ profil.assurance_decennale_numero }}" placeholder="987654321">
          </div>
          <div class="form-group">
            <label for="assurance_decennale_validite">Date de validit√©</label>
            <input class="input" type="date" id="assurance_decennale_validite" name="assurance_decennale_validite" value="{% if profil.assurance_decennale_validite %}{{ profil.assurance_decennale_validite|date:'Y-m-d' }}{% endif %}">
          </div>
        </div>
      </section>

      <!-- Qualifications -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="m7 21 5-5 5 5M12 3v13" stroke="currentColor" stroke-width="1.6"/></svg>
            5. Qualifications & certifications
          </h2>
          <div class="section-subtitle">RGE, Qualibat, etc.</div>
        </div>
        <div class="form-grid">
          <div class="form-group full">
            <label for="qualifications">Qualifications</label>
            <textarea class="textarea" id="qualifications" name="qualifications" rows="3" placeholder="Ex : RGE, Qualibat, ‚Ä¶">{{ profil.qualifications }}</textarea>
          </div>
        </div>
      </section>

      <!-- Banque -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 10h18M6 14h12M4 18h16M12 2 3 6v14h18V6l-9-4Z" stroke="currentColor" stroke-width="1.6"/></svg>
            6. Informations bancaires
          </h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label for="iban">IBAN</label>
            <input class="input" type="text" id="iban" name="iban" value="{{ profil.iban }}" placeholder="FR76 1234 5678 9012 3456 7890 123">
          </div>
          <div class="form-group">
            <label for="bic">BIC/SWIFT</label>
            <input class="input" type="text" id="bic" name="bic" value="{{ profil.bic }}" placeholder="BNPAFRPP">
          </div>
        </div>
      </section>

      <!-- Mentions devis -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M8 2h8a2 2 0 0 1 2 2v16l-6-3-6 3V4a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.6"/></svg>
            7. Mentions l√©gales du devis
          </h2>
        </div>
        <div class="form-grid">
          <div class="form-group full">
            <label for="mentions_legales_devis">Mentions l√©gales</label>
            <textarea class="textarea" id="mentions_legales_devis" name="mentions_legales_devis" rows="5" placeholder="Conditions de paiement, p√©nalit√©s de retard, ‚Ä¶">{{ profil.mentions_legales_devis }}</textarea>
          </div>
        </div>
      </section>

      <!-- Logo -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 5h16v14H4z" stroke="currentColor" stroke-width="1.6"/></svg>
            8. Logo de l'entreprise
          </h2>
        </div>
        {% if profil.logo %}
        <div class="logo-preview"><img src="{{ profil.logo.url }}" alt="Logo"></div>
        {% endif %}
        <div class="form-grid">
          <div class="form-group full">
            <label for="logo">{% if profil.logo %}Changer le logo{% else %}Ajouter un logo{% endif %}</label>
            <input class="input" type="file" id="logo" name="logo" accept="image/*">
            <small style="color:var(--muted)">PNG fond transparent recommand√©, 500√ó200px</small>
          </div>
        </div>
      </section>

      <div class="form-actions">
        <a href="{% url 'dashboard' %}" class="btn secondary">Annuler</a>
        <button type="submit" class="btn primary">üíæ Enregistrer le profil</button>
      </div>
    </form>
  </main>
</body>
</html>
