<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - CRM Artisans</title>
  <style>
    :root{
      --bg: #0b1220;
      --card: #0f172a;
      --muted: #94a3b8;
      --text: #e2e8f0;
      --primary: #6366f1;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --accent: #8b5cf6;
      --ring: rgba(99,102,241,.35);
      --border: rgba(148,163,184,.15);
      --shadow: 0 10px 25px rgba(2,6,23,.3), 0 1px 0 rgba(255,255,255,.03) inset;
      
      --bg-light: #f8fafc;
      --card-light: #ffffff;
      --text-light: #1e293b;
      --muted-light: #64748b;
      --border-light: rgba(30,41,59,.12);
      --shadow-light: 0 10px 25px rgba(30,41,59,.08), 0 1px 0 rgba(255,255,255,.8) inset;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.12), transparent 40%),
                  radial-gradient(1000px 600px at 80% 10%, rgba(139,92,246,.12), transparent 40%),
                  var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* Header */
    .header{
      position: sticky; top: 0; z-index: 40;
      backdrop-filter: saturate(180%) blur(8px);
      background: linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,.65));
      border-bottom: 1px solid var(--border);
    }
    .header-inner{
      max-width: 1280px; margin: 0 auto; padding: .85rem 1rem;
      display:flex; align-items:center; gap:1rem; justify-content: space-between;
    }
    .brand{ display:flex; align-items:center; gap:.75rem; font-weight:700; letter-spacing:.2px }
    .logo{ width:34px; height:34px; border-radius:10px; background:linear-gradient(145deg, var(--primary), var(--accent)); box-shadow: var(--shadow); display:grid; place-items:center; }
    .logo svg{ width:18px; height:18px; color:white }

    .nav{ display:flex; gap:.25rem; align-items:center }
    .nav a{ text-decoration:none; color:var(--muted); padding:.55rem .8rem; border-radius:10px; border:1px solid transparent }
    .nav a:hover{ color:var(--text); background:rgba(148,163,184,.08); border-color:var(--border) }
    .nav a.active{ color:white; background:rgba(99,102,241,.18); border-color: rgba(99,102,241,.35); box-shadow: 0 0 0 2px var(--ring) }

    .user{ display:flex; align-items:center; gap:.75rem; color:var(--muted); font-size:.95rem }
    .user form button{ background:none; border:none; color:var(--muted); cursor:pointer; text-decoration:underline; font:inherit }

    /* Main container */
    .container{ max-width:1280px; margin: 2rem auto; padding: 0 1rem }
    .page-title{ font-size: clamp(1.4rem, 2.4vw, 2rem); font-weight:800; letter-spacing:.2px; margin-bottom: 1.25rem }
    .subtitle{ color:var(--muted); margin-bottom:1.75rem }

    /* KPI layout */
    .kpi-grid{ display:grid; gap:1rem; grid-template-columns: repeat(12, 1fr); margin-bottom:2rem }
    .kpi{ background: linear-gradient(180deg, rgba(2,6,23,.6), rgba(2,6,23,.4)); border:1px solid var(--border); border-radius:16px; padding:1.1rem; box-shadow: var(--shadow); position:relative; overflow:hidden }
    .kpi:after{ content:""; position:absolute; inset:auto -30% -40% auto; width:180px; height:180px; background: radial-gradient(closest-side, rgba(99,102,241,.18), transparent 70%); transform: rotate(25deg) }
    .kpi h3{ font-size:.8rem; text-transform:uppercase; letter-spacing:.12rem; color:var(--muted); margin:0 0 .45rem }
    .kpi .value{ font-size: clamp(1.6rem, 2.5vw, 2.2rem); font-weight:800 }

    .kpi.ca{ grid-column: span 6 }
    .kpi.clients{ grid-column: span 6 }
    .kpi.devis, .kpi.planifier, .kpi.paiement{ grid-column: span 4 }

    .accent-success{ box-shadow: inset 0 0 0 1px rgba(34,197,94,.25) }
    .accent-info{ box-shadow: inset 0 0 0 1px rgba(99,102,241,.25) }
    .accent-warn{ box-shadow: inset 0 0 0 1px rgba(245,158,11,.25) }

    /* Sections */
    .section{ background: linear-gradient(180deg, rgba(2,6,23,.6), rgba(2,6,23,.4)); border:1px solid var(--border); border-radius:16px; padding:1rem; box-shadow: var(--shadow); margin-top:1.25rem }
    .section-header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; padding: .4rem .35rem .9rem; border-bottom:1px dashed var(--border) }
    .section-title{ display:flex; gap:.6rem; align-items:center; font-size:1.05rem; font-weight:700 }

    .toolbar{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center }
    .btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.55rem .8rem; border-radius:10px; border:1px solid var(--border); background:rgba(148,163,184,.07); color:var(--text); text-decoration:none; cursor:pointer; font-size:.9rem }
    .btn:hover{ background:rgba(148,163,184,.12) }
    .btn.primary{ background:linear-gradient(180deg, rgba(99,102,241,.18), rgba(99,102,241,.12)); border-color: rgba(99,102,241,.35); color:white }
    .btn.active{ background:linear-gradient(180deg, rgba(99,102,241,.25), rgba(99,102,241,.15)); border-color: rgba(99,102,241,.4); color:white }

    /* Calendar */
    .calendar-container{ margin-top:1rem }
    .calendar-nav{ display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem; flex-wrap:wrap; gap:1rem }
    .calendar-nav-left{ display:flex; align-items:center; gap:.5rem }
    .calendar-nav-right{ display:flex; align-items:center; gap:.25rem }

    .calendar-title{ font-size:1.1rem; font-weight:600; margin:0 1rem }
    .nav-btn{ display:flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:8px; border:1px solid var(--border); background:rgba(148,163,184,.07); color:var(--text); cursor:pointer }
    .nav-btn:hover{ background:rgba(148,163,184,.12) }

    /* Vue semaine */
    .week-view{ display:grid; grid-template-columns: 80px repeat(7, 1fr); gap:1px; background:var(--border); border-radius:12px; overflow:hidden }
    .week-header{ background:rgba(15,23,42,.8); padding:.75rem .5rem; text-align:center; font-size:.8rem; color:var(--muted) }
    .time-slot{ background:rgba(2,6,23,.4); padding:.5rem; font-size:.75rem; color:var(--muted); border-right:1px solid var(--border) }
    .day-column{ background:rgba(2,6,23,.4); min-height:60px; position:relative; padding:.25rem }

    .event{ 
      background:linear-gradient(135deg, rgba(99,102,241,.2), rgba(99,102,241,.1)); 
      border:1px solid rgba(99,102,241,.3); 
      border-radius:6px; 
      padding:.25rem .5rem; 
      font-size:.75rem; 
      cursor:pointer; 
      margin-bottom:.25rem;
      color:var(--text);
    }
    .event:hover{ background:linear-gradient(135deg, rgba(99,102,241,.3), rgba(99,102,241,.15)) }

    /* Vue jour */
    .day-view{ display:none }
    .day-timeline{ display:grid; grid-template-columns: 80px 1fr; gap:1px; background:var(--border); border-radius:12px; overflow:hidden }
    .time-column{ background:rgba(15,23,42,.8) }
    .events-column{ background:rgba(2,6,23,.4) }
    .hour-slot{ height:60px; display:flex; align-items:flex-start; padding:.5rem; font-size:.75rem; color:var(--muted); border-bottom:1px solid var(--border) }
    .event-container{ height:60px; position:relative; border-bottom:1px solid var(--border); padding:.25rem }

    /* Vue mois */
    .month-view{ display:none }
    .month-grid{ display:grid; grid-template-columns: repeat(7, 1fr); gap:1px; background:var(--border); border-radius:12px; overflow:hidden }
    .month-day{ background:rgba(2,6,23,.4); min-height:100px; padding:.5rem; position:relative }
    .month-day.other-month{ opacity:.3 }
    .month-day.today{ background:rgba(99,102,241,.1); border:1px solid rgba(99,102,241,.3) }
    .day-number{ font-size:.9rem; font-weight:600; margin-bottom:.25rem }
    .month-event{ 
      background:rgba(99,102,241,.2); 
      border:1px solid rgba(99,102,241,.3); 
      border-radius:4px; 
      padding:.1rem .3rem; 
      font-size:.7rem; 
      margin-bottom:.2rem; 
      cursor:pointer 
    }

    /* Tooltip */
    .tooltip{ 
      position:absolute; 
      background:rgba(15,23,42,.95); 
      border:1px solid var(--border); 
      border-radius:8px; 
      padding:.75rem; 
      font-size:.8rem; 
      z-index:100; 
      box-shadow:var(--shadow); 
      max-width:250px;
      display:none;
    }

    /* Responsive */
    @media (max-width: 720px){
      .kpi.ca, .kpi.clients, .kpi.devis, .kpi.planifier, .kpi.paiement{ grid-column: 1 / -1 }
      .calendar-nav{ flex-direction:column; align-items:flex-start }
      .week-view{ grid-template-columns: 60px repeat(7, 1fr) }
      .day-view{ display:block }
      .week-view{ display:none }
      .month-view{ display:none }
    }

    /* Light mode */
    @media (prefers-color-scheme: light){
      :root{ 
        --bg: var(--bg-light); 
        --card: var(--card-light);
        --text: var(--text-light); 
        --muted: var(--muted-light); 
        --border: var(--border-light);
        --shadow: var(--shadow-light);
      }
      
      body{
        background: radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.05), transparent 40%),
                    radial-gradient(1000px 600px at 80% 10%, rgba(139,92,246,.05), transparent 40%),
                    var(--bg);
      }
      
      .header{ 
        background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.8));
        backdrop-filter: saturate(180%) blur(8px);
      }
      
      .kpi, .section{ 
        background: var(--card);
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
      }
      
      .week-header, .time-column{ background: rgba(248,250,252,.9) }
      .day-column, .time-slot, .month-day{ background: var(--card) }
      .tooltip{ background: rgba(255,255,255,.98) }
      
      .nav a.active, .btn.active{ 
        color: var(--primary); 
        background: rgba(99,102,241,.08);
        border-color: rgba(99,102,241,.2);
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M4 14.5 12 4l8 10.5-8 5.5-8-5.5Z" stroke="currentColor" stroke-width="1.6"/>
          </svg>
        </div>
        <span>CRM Artisans</span>
      </div>
      <nav class="nav">
        <a href="#" class="active">Accueil</a>
        <a href="#">Opérations</a>
        <a href="#">Clients</a>
      </nav>
      <div class="user">
        <span>Connecté·e : Martin Dupont</span>
        <form>
          <button type="button">Déconnexion</button>
        </form>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="page-title">Tableau de bord</h1>
    <p class="subtitle">Vue d'ensemble des performances et du planning.</p>

    <!-- KPI -->
    <section class="kpi-grid">
      <article class="kpi ca accent-success">
        <h3>CA du mois</h3>
        <div class="value">3 250 €</div>
      </article>
      <article class="kpi clients accent-info">
        <h3>Clients</h3>
        <div class="value">24</div>
      </article>
      <article class="kpi devis accent-warn">
        <h3>En attente devis</h3>
        <div class="value">3</div>
      </article>
      <article class="kpi planifier accent-info">
        <h3>À planifier</h3>
        <div class="value">2</div>
      </article>
      <article class="kpi paiement accent-warn">
        <h3>Attente paiement</h3>
        <div class="value">4</div>
      </article>
    </section>

    <!-- Planning Calendar -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.6"/>
          </svg>
          Planning des interventions
        </h2>
        <div class="toolbar">
          <a href="#" class="btn primary">Nouvelle opération</a>
        </div>
      </div>

      <div class="calendar-container">
        <div class="calendar-nav">
          <div class="calendar-nav-left">
            <button class="nav-btn" onclick="changeWeek(-1)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            <div class="calendar-title" id="calendar-title">Semaine du 23 au 29 Sept 2025</div>
            <button class="nav-btn" onclick="changeWeek(1)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            <button class="btn" onclick="goToToday()">Aujourd'hui</button>
          </div>
          <div class="calendar-nav-right">
            <button class="btn" onclick="setView('day')" id="day-btn">Jour</button>
            <button class="btn active" onclick="setView('week')" id="week-btn">Semaine</button>
            <button class="btn" onclick="setView('month')" id="month-btn">Mois</button>
          </div>
        </div>

        <!-- Vue Semaine -->
        <div class="week-view" id="week-view">
          <div class="week-header">Horaires</div>
          <div class="week-header">Lun<br>23</div>
          <div class="week-header">Mar<br>24</div>
          <div class="week-header">Mer<br>25</div>
          <div class="week-header">Jeu<br>26</div>
          <div class="week-header">Ven<br>27</div>
          <div class="week-header">Sam<br>28</div>
          <div class="week-header">Dim<br>29</div>
          
          <div class="time-slot">08:00</div>
          <div class="day-column"></div>
          <div class="day-column">
            <div class="event" onclick="showTooltip(event, 'event1')">
              09:00 - Piano M. Martin<br>
              <small>📍 15 rue des Lilas</small>
            </div>
          </div>
          <div class="day-column"></div>
          <div class="day-column">
            <div class="event" onclick="showTooltip(event, 'event2')">
              08:30 - Chaudière Mme Durand<br>
              <small>📍 22 av. de la République</small>
            </div>
          </div>
          <div class="day-column"></div>
          <div class="day-column"></div>
          <div class="day-column"></div>

          <div class="time-slot">14:00</div>
          <div class="day-column"></div>
          <div class="day-column"></div>
          <div class="day-column">
            <div class="event" onclick="showTooltip(event, 'event3')">
              14:30 - Installation M. Rousseau<br>
              <small>📍 8 impasse du Moulin</small>
            </div>
          </div>
          <div class="day-column"></div>
          <div class="day-column">
            <div class="event" onclick="showTooltip(event, 'event4')">
              15:00 - Dépannage Mme Petit<br>
              <small>📍 33 rue Victor Hugo</small>
            </div>
          </div>
          <div class="day-column"></div>
          <div class="day-column"></div>
        </div>

        <!-- Vue Jour -->
        <div class="day-view" id="day-view">
          <div class="day-timeline">
            <div class="time-column">
              <div class="hour-slot">08:00</div>
              <div class="hour-slot">09:00</div>
              <div class="hour-slot">10:00</div>
              <div class="hour-slot">14:00</div>
              <div class="hour-slot">15:00</div>
              <div class="hour-slot">16:00</div>
            </div>
            <div class="events-column">
              <div class="event-container"></div>
              <div class="event-container">
                <div class="event">09:00 - Piano M. Martin - 15 rue des Lilas</div>
              </div>
              <div class="event-container"></div>
              <div class="event-container">
                <div class="event">14:30 - Installation M. Rousseau - 8 impasse du Moulin</div>
              </div>
              <div class="event-container"></div>
              <div class="event-container"></div>
            </div>
          </div>
        </div>

        <!-- Vue Mois -->
        <div class="month-view" id="month-view">
          <div class="month-grid">
            <div class="week-header">Lun</div>
            <div class="week-header">Mar</div>
            <div class="week-header">Mer</div>
            <div class="week-header">Jeu</div>
            <div class="week-header">Ven</div>
            <div class="week-header">Sam</div>
            <div class="week-header">Dim</div>
            
            <div class="month-day other-month"><div class="day-number">31</div></div>
            <div class="month-day"><div class="day-number">1</div></div>
            <div class="month-day"><div class="day-number">2</div></div>
            <div class="month-day"><div class="day-number">3</div></div>
            <div class="month-day"><div class="day-number">4</div></div>
            <div class="month-day"><div class="day-number">5</div></div>
            <div class="month-day"><div class="day-number">6</div></div>
            
            <div class="month-day"><div class="day-number">23</div></div>
            <div class="month-day today">
              <div class="day-number">24</div>
              <div class="month-event">Piano M. Martin</div>
            </div>
            <div class="month-day">
              <div class="day-number">25</div>
              <div class="month-event">Installation M. R.</div>
            </div>
            <div class="month-day">
              <div class="day-number">26</div>
              <div class="month-event">Chaudière Mme D.</div>
            </div>
            <div class="month-day">
              <div class="day-number">27</div>
              <div class="month-event">Dépannage Mme P.</div>
            </div>
            <div class="month-day"><div class="day-number">28</div></div>
            <div class="month-day"><div class="day-number">29</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Actions rapides -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M4 7h10M4 12h7M4 17h13" stroke="currentColor" stroke-width="1.6"/>
          </svg>
          Actions rapides
        </h2>
      </div>
      <div class="toolbar">
        <a href="#" class="btn primary">Nouvelle opération</a>
        <a href="#" class="btn">Voir les clients</a>
        <a href="#" class="btn">Rapports</a>
      </div>
    </section>
  </main>

  <!-- Tooltip -->
  <div class="tooltip" id="tooltip">
    <div id="tooltip-content"></div>
  </div>

  <script>
    const calendarEvents = {{ calendar_events|safe }};
    let currentView = 'week';
    let currentWeek = 0;

    function setView(view) {
      // Update buttons
      document.querySelectorAll('.calendar-nav-right .btn').forEach(btn => 
        btn.classList.remove('active'));
      document.getElementById(view + '-btn').classList.add('active');

      // Update views
      document.getElementById('week-view').style.display = view === 'week' ? 'grid' : 'none';
      document.getElementById('day-view').style.display = view === 'day' ? 'block' : 'none';
      document.getElementById('month-view').style.display = view === 'month' ? 'block' : 'none';

      currentView = view;
      updateTitle();
    }

    function changeWeek(direction) {
      currentWeek += direction;
      updateTitle();
    }

    function goToToday() {
      currentWeek = 0;
      updateTitle();
    }

    function updateTitle() {
      const titleEl = document.getElementById('calendar-title');
      if (currentView === 'week') {
        const baseDate = new Date(2025, 8, 23); // 23 septembre 2025
        baseDate.setDate(baseDate.getDate() + (currentWeek * 7));
        const endDate = new Date(baseDate);
        endDate.setDate(endDate.getDate() + 6);
        
        titleEl.textContent = `Semaine du ${baseDate.getDate()} au ${endDate.getDate()} Sept 2025`;
      } else if (currentView === 'day') {
        titleEl.textContent = 'Mercredi 25 Septembre 2025';
      } else {
        titleEl.textContent = 'Septembre 2025';
      }
    }

    function showTooltip(event, eventId) {
      event.stopPropagation();
      const tooltip = document.getElementById('tooltip');
      const content = document.getElementById('tooltip-content');
      
      // Données d'exemple selon l'event
      const eventData = {
        'event1': {
          client: 'M. Martin',
          service: 'Accord de piano',
          time: '09:00 - 10:30',
          address: '15 rue des Lilas, Strasbourg',
          phone: '06 12 34 56 78',
          notes: 'Piano droit, accord complet'
        },
        'event2': {
          client: 'Mme Durand',
          service: 'Révision chaudière',
          time: '08:30 - 11:00',
          address: '22 avenue de la République',
          phone: '06 98 76 54 32',
          notes: 'Contrat annuel'
        }
      };

      const data = eventData[eventId] || eventData['event1'];
      
      content.innerHTML = `
        <div style="font-weight:600; margin-bottom:.5rem">${data.client}</div>
        <div style="color:var(--muted); margin-bottom:.25rem">${data.service}</div>
        <div style="color:var(--muted); margin-bottom:.25rem">⏰ ${data.time}</div>
        <div style="color:var(--muted); margin-bottom:.25rem">📍 ${data.address}</div>
        <div style="color:var(--muted); margin-bottom:.25rem">📞 ${data.phone}</div>
        <div style="color:var(--muted); font-size:.75rem">${data.notes}</div>
      `;

      tooltip.style.display = 'block';
      tooltip.style.left = event.pageX + 10 + 'px';
      tooltip.style.top = event.pageY + 10 + 'px';
    }

    // Close tooltip when clicking elsewhere
    document.addEventListener('click', () => {
      document.getElementById('tooltip').style.display = 'none';
    });

    // Initialize
    setView('week');

    // Responsive: switch to day view on mobile
    function checkMobile() {
      if (window.innerWidth <= 720) {
        setView('day');
      }
    }

    window.addEventListener('resize', checkMobile);
    checkMobile();
  </script>
</body>
</html>