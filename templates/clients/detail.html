<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ client.nom }} {{ client.prenom }} – CRM Artisans</title>
  <style>
    :root{
      --bg: #0b1220;
      --card: #0f172a;
      --muted: #94a3b8;
      --text: #e2e8f0;
      --primary: #6366f1;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --accent: #8b5cf6;
      --ring: rgba(99,102,241,.35);
      --border: rgba(148,163,184,.15);
      --shadow: 0 10px 25px rgba(2,6,23,.3), 0 1px 0 rgba(255,255,255,.03) inset;

      --bg-light: #f8fafc;
      --card-light: #ffffff;
      --text-light: #1e293b;
      --muted-light: #64748b;
      --border-light: rgba(30,41,59,.12);
      --shadow-light: 0 10px 25px rgba(30,41,59,.08), 0 1px 0 rgba(255,255,255,.8) inset;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.12), transparent 40%),
                  radial-gradient(1000px 600px at 80% 10%, rgba(139,92,246,.12), transparent 40%),
                  var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* Header harmonisé */
    .header{ 
      position: sticky; top: 0; z-index: 40; 
      backdrop-filter: saturate(180%) blur(8px); 
      background: linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,.65)); 
      border-bottom: 1px solid var(--border) 
    }
    .header-inner{ 
      max-width:1280px; margin:0 auto; padding:.85rem 1rem; 
      display:flex; align-items:center; gap:1rem; justify-content:space-between 
    }
    .brand{ display:flex; align-items:center; gap:.75rem; font-weight:700; letter-spacing:.2px }
    .logo{ 
      width:34px; height:34px; border-radius:10px; 
      background:linear-gradient(145deg, var(--primary), var(--accent)); 
      box-shadow: var(--shadow); display:grid; place-items:center 
    }
    .logo svg{ width:18px; height:18px; color:white }
    .nav{ display:flex; gap:.25rem; align-items:center }
    .nav a{ 
      text-decoration:none; color:var(--muted); padding:.55rem .8rem; 
      border-radius:10px; border:1px solid transparent 
    }
    .nav a:hover{ color:var(--text); background:rgba(148,163,184,.08); border-color:var(--border) }
    .nav a.active{ 
      color:white; background:rgba(99,102,241,.18); 
      border-color: rgba(99,102,241,.35); box-shadow: 0 0 0 2px var(--ring) 
    }
    .user{ display:flex; align-items:center; gap:.75rem; color:var(--muted); font-size:.95rem }
    .user form button{ 
      background:none; border:none; color:var(--muted); cursor:pointer; 
      text-decoration:underline; font:inherit 
    }

    /* Main harmonisé */
    .container{ max-width:1280px; margin: 2rem auto; padding: 0 1rem }
    .breadcrumb{ color:var(--muted); font-size:.9rem; margin-bottom: 1rem }
    .breadcrumb a{ color:var(--muted); text-decoration:none }
    .breadcrumb a:hover{ color:var(--text) }

    /* En-tête client harmonisé */
    .client-header{ 
      display:flex; align-items:center; justify-content:space-between; gap:1rem; 
      margin-bottom: 1.5rem; flex-wrap:wrap 
    }
    .client-info{ display:flex; align-items:center; gap:1rem }
    .client-avatar{ 
      width:48px; height:48px; border-radius:12px; 
      background:linear-gradient(145deg, var(--primary), var(--accent)); 
      border:1px solid var(--border); display:grid; place-items:center; 
      color:#fff; font-weight:800; font-size:1.1rem; flex-shrink:0;
      box-shadow: var(--shadow);
    }
    .client-details h1{ 
      font-size: clamp(1.4rem, 2.4vw, 2rem); font-weight:800; 
      letter-spacing:.2px; margin:0 0 .25rem 
    }
    .client-id{ color:var(--muted); font-size:.9rem; font-weight:500 }

    /* Actions harmonisées */
    .actions{ display:flex; gap:.5rem; flex-wrap:wrap }

    /* Cards/sections harmonisées */
    .section{ 
      background: linear-gradient(180deg, rgba(2,6,23,.6), rgba(2,6,23,.4)); 
      border:1px solid var(--border); border-radius:16px; padding:1rem; 
      box-shadow: var(--shadow); margin-top:1rem 
    }
    .section-header{ 
      display:flex; align-items:center; justify-content:space-between; gap:1rem; 
      padding:.4rem .35rem .9rem; border-bottom:1px dashed var(--border) 
    }
    .section-title{ display:flex; gap:.6rem; align-items:center; font-size:1.05rem; font-weight:700 }
    .badge{ 
      font-size:.75rem; color:var(--muted); padding:.15rem .5rem; 
      border-radius:999px; border:1px solid var(--border); 
      background: rgba(148,163,184,.08) 
    }

    /* Toolbar & buttons harmonisés */
    .toolbar{ display:flex; gap:.5rem; flex-wrap:wrap }
    .btn{ 
      display:inline-flex; align-items:center; gap:.5rem; padding:.55rem .8rem; 
      border-radius:10px; border:1px solid var(--border); 
      background:rgba(148,163,184,.07); color:var(--text); 
      text-decoration:none; cursor:pointer; font:inherit 
    }
    .btn:hover{ background:rgba(148,163,184,.12) }
    .btn.primary{ 
      background:linear-gradient(180deg, rgba(99,102,241,.18), rgba(99,102,241,.12)); 
      border-color: rgba(99,102,241,.35); color: white 
    }
    .btn.danger{ 
      background: linear-gradient(180deg, rgba(239,68,68,.15), rgba(239,68,68,.1)); 
      border-color: rgba(239,68,68,.35); color: white 
    }
    .btn.sm{ padding:.4rem .6rem; border-radius:8px; font-size:.9rem }

    /* Grille d'informations AMÉLIORÉE */
    .info-grid{ 
      display:grid; 
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap:1.25rem; 
      padding: 0.5rem 0;
    }
    
    .info-card{
      background: rgba(148,163,184,.03);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      position: relative;
      transition: all 0.2s ease;
    }
    
    .info-card:hover{
      background: rgba(148,163,184,.05);
      border-color: rgba(148,163,184,.2);
    }
    
    .info-card .label{
      display: flex;
      align-items: center;
      gap: .5rem;
      color: var(--muted);
      font-size: .85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .05rem;
      margin-bottom: .75rem;
    }
    
    .info-card .value{
      color: var(--text);
      font-weight: 600;
      font-size: 1rem;
      line-height: 1.4;
    }
    
    .info-card .value.empty{
      color: var(--muted);
      font-style: italic;
      font-weight: 400;
    }
    
    .info-card .value a{
      color: var(--primary);
      text-decoration: none;
    }
    
    .info-card .value a:hover{
      text-decoration: underline;
    }

    /* Formulaire d'édition harmonisé */
    .edit-field{ display:flex; flex-direction:column; gap:.4rem }
    .edit-field label{ color:var(--muted); font-size:.9rem; font-weight:600 }
    .input{ 
      width:100%; padding:.65rem .8rem; border-radius:10px; 
      border:1px solid var(--border); background: rgba(2,6,23,.35); 
      color: var(--text); font:inherit 
    }
    .input::placeholder{ color: rgba(226,232,240,.55) }
    .input:focus{ 
      outline:none; box-shadow: 0 0 0 2px var(--ring); 
      border-color: rgba(99,102,241,.35) 
    }

    /* Stats harmonisées */
    .stats{ display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:1rem }
    .stat{ 
      background: rgba(148,163,184,.03); border:1px solid var(--border); 
      border-radius:12px; padding:1rem; text-align:center 
    }
    .stat-value{ font-size:1.5rem; font-weight:800; margin-bottom:.25rem }
    .stat-label{ font-size:.85rem; color:var(--muted); text-transform:uppercase; letter-spacing:.05rem }

    /* Table harmonisée */
    .table-wrap{ overflow:auto; border-radius:12px; border:1px solid var(--border) }
    table{ width:100%; border-collapse: collapse; min-width: 800px }
    thead th{ 
      position:sticky; top:0; background: rgba(15,23,42,.9); backdrop-filter: blur(6px); 
      color:var(--muted); text-transform:uppercase; letter-spacing:.08rem; 
      font-size:.75rem; text-align:left; padding:.9rem .85rem; 
      border-bottom:1px solid var(--border) 
    }
    tbody td{ padding:.9rem .85rem; border-bottom:1px dashed var(--border); vertical-align: top }
    tbody tr:hover{ background: rgba(148,163,184,.05) }

    .chip{ 
      display:inline-flex; align-items:center; gap:.35rem; padding:.2rem .55rem; 
      border-radius:999px; font-size:.78rem; border:1px solid var(--border); 
      color: var(--muted); background: rgba(148,163,184,.08); text-decoration:none
    }
    .chip:hover{ background: rgba(148,163,184,.12) }
    .chip.status{ color:#60a5fa; border-color: rgba(59,130,246,.35); background: rgba(59,130,246,.08) }
    .chip.success{ color:#22c55e; border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.08) }
    .chip.warning{ color:#f59e0b; border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.08) }

    /* Responsive */
    @media (max-width: 780px){
      .client-header{ flex-direction: column; align-items: stretch }
      .client-info{ flex-direction: column; text-align: center; gap:.75rem }
      .info-grid{ grid-template-columns: 1fr }
      .stats{ grid-template-columns: repeat(2, 1fr) }
      .actions{ justify-content: center }
      .table-wrap{ border:none }
      table{ display:block }
      thead{ display:none }
      tbody{ display:grid; gap:.75rem }
      tbody tr{ 
        display:grid; gap:.45rem; border:1px solid var(--border); 
        border-radius:12px; padding:.85rem; background: rgba(2,6,23,.5) 
      }
      tbody td{ padding:.15rem 0; border:none }
      tbody td[data-label]{ color:var(--muted); font-size:.78rem }
    }

    /* Light mode harmonisé */
    @media (prefers-color-scheme: light){
      :root{ 
        --bg: var(--bg-light); 
        --card: var(--card-light); 
        --text: var(--text-light); 
        --muted: var(--muted-light); 
        --border: var(--border-light); 
        --shadow: var(--shadow-light);
      }
      
      body{ 
        background: radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.05), transparent 40%), 
                    radial-gradient(1000px 600px at 80% 10%, rgba(139,92,246,.05), transparent 40%), 
                    var(--bg) 
      }
      
      .header{ 
        background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.8));
        backdrop-filter: saturate(180%) blur(8px);
        border-bottom: 1px solid var(--border);
      }
      
      .section, .table-wrap{ 
        background: var(--card); 
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
      }
      
      .info-card, .stat{ 
        background: rgba(248,250,252,.6); 
        border: 1px solid var(--border)
      }
      
      .info-card:hover{
        background: rgba(248,250,252,.9);
      }
      
      thead th{ 
        background: rgba(248,250,252,.95); 
        backdrop-filter: blur(6px);
        color: var(--muted) 
      }
      
      .input{ 
        background: #fff; 
        border-color: var(--border); 
        color: var(--text) 
      }
      .input::placeholder{ color: rgba(100,116,139,.6) }
      
      .nav a{ color: var(--muted) }
      .nav a:hover{ color: var(--text) }
      .nav a.active{ 
        color: var(--primary); 
        background: rgba(99,102,241,.08); 
        border-color: rgba(99,102,241,.2) 
      }
      
      .user{ color: var(--muted) }
      .user form button{ color: var(--muted) }
      
      .btn{ 
        background: rgba(148,163,184,.06); 
        color: var(--text);
        border: 1px solid var(--border);
      }
      .btn:hover{ background: rgba(148,163,184,.1) }
      
      .btn.primary{ 
        background: rgba(99,102,241,.1); 
        border-color: rgba(99,102,241,.2);
        color: var(--primary);
      }
      
      .btn.danger{ 
        background: rgba(239,68,68,.1); 
        border-color: rgba(239,68,68,.2);
        color: #dc2626;
      }
      
      .chip{ 
        color: var(--muted);
        border: 1px solid var(--border);
        background: rgba(148,163,184,.04);
      }
      .chip.status{ 
        color: #2563eb; 
        border-color: rgba(37,99,235,.25); 
        background: rgba(37,99,235,.06);
      }
      .chip.success{ 
        color: #16a34a; 
        border-color: rgba(22,163,74,.25); 
        background: rgba(22,163,74,.06);
      }
      .chip.warning{ 
        color: #d97706; 
        border-color: rgba(217,119,6,.25); 
        background: rgba(217,119,6,.06);
      }
      
      tbody tr{ background: transparent }
      tbody tr:hover{ background: rgba(148,163,184,.03) }
      
      @media (max-width:780px){ 
        tbody tr{ 
          background: rgba(248,250,252,.8);
          border: 1px solid var(--border);
        } 
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 14.5 12 4l8 10.5-8 5.5-8-5.5Z" stroke="currentColor" stroke-width="1.6"/>
          </svg>
        </div>
        <span>CRM Artisans</span>
      </div>
      <nav class="nav" aria-label="Navigation principale">
        <a href="{% url 'dashboard' %}">Accueil</a>
        <a href="{% url 'operations' %}">Opérations</a>
        <a href="{% url 'clients' %}" class="active">Clients</a>
      </nav>
      <div class="user">
        <span>Connecté·e : {{ user.username }}</span>
        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit" title="Se déconnecter">Déconnexion</button>
        </form>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="breadcrumb">
      <a href="{% url 'clients' %}">Clients</a> / {{ client.nom }} {{ client.prenom }}
    </div>

    <div class="client-header">
      <div class="client-info">
        <div class="client-avatar" aria-hidden="true">
          {{ client.nom|first|upper }}{{ client.prenom|first|upper }}
        </div>
        <div class="client-details">
          <h1>{{ client.nom }} {{ client.prenom }}</h1>
          <div class="client-id">Client #{{ client.id_client }}</div>
        </div>
      </div>
      <div class="actions">
        <a href="{% url 'operation_create' %}?client={{ client.id }}" class="btn primary" title="Créer une opération">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
          Nouvelle opération
        </a>
        <form method="POST" action="{% url 'client_delete' client.id %}" onsubmit="return confirmDelete()" style="display:inline">
          {% csrf_token %}
          <input type="hidden" name="force_delete" value="true">
          <button type="submit" class="btn danger" title="Supprimer le client">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M9 7v12m6-12v12M6 7l1 13a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-13M9 7l1-3h4l1 3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
            Supprimer
          </button>
        </form>
      </div>
    </div>

    <!-- Informations client AMÉLIORÉES -->
    <section class="section" aria-labelledby="info-title">
      <div class="section-header">
        <h2 class="section-title" id="info-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm7 9H5a2 2 0 0 1-2-2v-1a6 6 0 0 1 6-6h6a6 6 0 0 1 6 6v1a2 2 0 0 1-2 2Z" stroke="currentColor" stroke-width="1.6"/></svg>
          Informations client
        </h2>
        <div class="toolbar">
          <button id="editBtn" class="btn" onclick="toggleEdit()" title="Éditer">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="m4 20 4.8-1.2L20 7.6 16.4 4 5.6 14.8 4 20Z" stroke="currentColor" stroke-width="1.4"/></svg>
            Éditer
          </button>
          <button id="saveBtn" class="btn primary" style="display:none" onclick="saveClient()" title="Enregistrer">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="m5 12 4 4 10-10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
            Enregistrer
          </button>
          <button id="cancelBtn" class="btn" style="display:none" onclick="cancelEdit()" title="Annuler">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 18 18 6M6 6l12 12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
            Annuler
          </button>
        </div>
      </div>
      <div class="section-body">
        <div class="info-grid" id="displayMode">
          <div class="info-card">
            <div class="label">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="1.5"/></svg>
              Nom complet
            </div>
            <div class="value">{{ client.nom }} {{ client.prenom }}</div>
          </div>
          
          <div class="info-card">
            <div class="label">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92Z" stroke="currentColor" stroke-width="1.5"/></svg>
              Téléphone
            </div>
            <div class="value">
              <a href="tel:{{ client.telephone }}">{{ client.telephone }}</a>
            </div>
          </div>
          
          <div class="info-card">
            <div class="label">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2Z" stroke="currentColor" stroke-width="1.5"/><path d="M22 6 12 13 2 6" stroke="currentColor" stroke-width="1.5"/></svg>
              Email
            </div>
            <div class="value">
              {% if client.email %}
                <a href="mailto:{{ client.email }}">{{ client.email }}</a>
              {% else %}
                <span class="empty">Non renseigné</span>
              {% endif %}
            </div>
          </div>
          
          <div class="info-card">
            <div class="label">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="1.5"/><circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="1.5"/></svg>
              Adresse
            </div>
            <div class="value">
              {% if client.adresse %}
                {{ client.adresse }}{% if client.ville %}<br>{{ client.ville }}{% endif %}
              {% else %}
                <span class="empty">Non renseignée</span>
              {% endif %}
            </div>
          </div>
          
          <div class="info-card">
            <div class="label">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.5"/></svg>
              Client depuis
            </div>
            <div class="value">{{ client.date_creation|date:"d/m/Y" }}</div>
          </div>
        </div>

        <form method="POST" action="{% url 'client_edit' client.id %}" id="editForm" style="display:none">
          {% csrf_token %}
          <div class="info-grid">
            <div class="edit-field">
              <label for="edit-nom">Nom *</label>
              <input class="input" type="text" id="edit-nom" name="nom" value="{{ client.nom }}" required>
            </div>
            <div class="edit-field">
              <label for="edit-prenom">Prénom</label>
              <input class="input" type="text" id="edit-prenom" name="prenom" value="{{ client.prenom }}">
            </div>
            <div class="edit-field">
              <label for="edit-telephone">Téléphone *</label>
              <input class="input" type="tel" id="edit-telephone" name="telephone" value="{{ client.telephone }}" required>
            </div>
            <div class="edit-field">
              <label for="edit-email">Email</label>
              <input class="input" type="email" id="edit-email" name="email" value="{{ client.email }}">
            </div>
            <div class="edit-field">
              <label for="edit-adresse">Adresse</label>
              <input class="input" type="text" id="edit-adresse" name="adresse" value="{{ client.adresse }}">
            </div>
            <div class="edit-field">
              <label for="edit-ville">Ville</label>
              <input class="input" type="text" id="edit-ville" name="ville" value="{{ client.ville }}">
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- Statistiques -->
    <section class="section" aria-labelledby="stats-title">
      <div class="section-header">
        <h2 class="section-title" id="stats-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 18h16M6 18V8m4 10V4m4 14v-6m4 6v-3" stroke="currentColor" stroke-width="1.6"/></svg>
          Statistiques
        </h2>
      </div>
      <div class="section-body">
        <div class="stats">
          <div class="stat">
            <div class="stat-value">{{ nb_operations }}</div>
            <div class="stat-label">Opérations</div>
          </div>
          <div class="stat">
            <div class="stat-value">{{ ca_total }}€</div>
            <div class="stat-label">CA total</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Historique des opérations -->
    <section class="section" aria-labelledby="history-title">
      <div class="section-header">
        <h2 class="section-title" id="history-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M7 10h10M7 14h7M4 6h16v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Z" stroke="currentColor" stroke-width="1.6"/></svg>
          Historique des opérations <span class="badge">{{ nb_operations }}</span>
        </h2>
      </div>
      <div class="section-body">
        {% if operations %}
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Type d'opération</th>
                  <th>Montant</th>
                  <th>Statut</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for operation in operations %}
                  <tr>
                    <td data-label="Date">
                      {% if operation.date_prevue %}
                        {{ operation.date_prevue|date:"d/m/Y H:i" }}
                      {% else %}
                        {{ operation.date_creation|date:"d/m/Y" }}
                      {% endif %}
                    </td>
                    <td data-label="Type">{{ operation.type_prestation|truncatechars:50 }}</td>
                    <td data-label="Montant"><strong>{{ operation.montant_total }}€</strong></td>
                    <td data-label="Statut">
                      {% if operation.statut == 'en_attente_devis' %}
                        <span class="chip warning">En attente devis</span>
                      {% elif operation.statut == 'a_planifier' %}
                        <span class="chip status">À planifier</span>
                      {% elif operation.statut == 'realise' %}
                        <span class="chip success">Réalisée</span>
                      {% else %}
                        <span class="chip">{{ operation.get_statut_display }}</span>
                      {% endif %}
                    </td>
                    <td data-label="Actions">
                      <a href="{% url 'operation_detail' operation.pk %}" class="btn sm">Voir détails</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div style="text-align:center; color:var(--muted); padding:2rem">
            <p>Aucune opération pour ce client.</p>
            <div class="actions" style="justify-content:center; margin-top:1rem">
              <a href="{% url 'operation_create' %}?client={{ client.id }}" class="btn primary">
                Créer la première opération
              </a>
            </div>
          </div>
        {% endif %}
      </div>
    </section>

    <!-- Actions finales -->
    <div class="actions" style="margin-top:1.5rem; justify-content:flex-start">
      <a href="{% url 'clients' %}" class="btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="1.5"/></svg>
        Retour à la liste
      </a>
    </div>
  </main>

  <script>
    let originalValues = {};
    function toggleEdit(){
      originalValues = {
        nom:document.getElementById('edit-nom').value,
        prenom:document.getElementById('edit-prenom').value,
        telephone:document.getElementById('edit-telephone').value,
        email:document.getElementById('edit-email').value,
        adresse:document.getElementById('edit-adresse').value,
        ville:document.getElementById('edit-ville').value
      };
      document.getElementById('displayMode').style.display='none';
      document.getElementById('editForm').style.display='block';
      document.getElementById('editBtn').style.display='none';
      document.getElementById('saveBtn').style.display='inline-flex';
      document.getElementById('cancelBtn').style.display='inline-flex';
    }
    function cancelEdit(){
      document.getElementById('edit-nom').value=originalValues.nom;
      document.getElementById('edit-prenom').value=originalValues.prenom;
      document.getElementById('edit-telephone').value=originalValues.telephone;
      document.getElementById('edit-email').value=originalValues.email;
      document.getElementById('edit-adresse').value=originalValues.adresse;
      document.getElementById('edit-ville').value=originalValues.ville;
      document.getElementById('displayMode').style.display='grid';
      document.getElementById('editForm').style.display='none';
      document.getElementById('editBtn').style.display='inline-flex';
      document.getElementById('saveBtn').style.display='none';
      document.getElementById('cancelBtn').style.display='none';
    }
    function saveClient(){
      const nom=document.getElementById('edit-nom').value.trim();
      const telephone=document.getElementById('edit-telephone').value.trim();
      if(!nom||!telephone){ alert('Le nom et le téléphone sont obligatoires'); return; }
      document.getElementById('editForm').submit();
    }
    function confirmDelete(){
      return confirm('ATTENTION : Supprimer {{ client.nom }} {{ client.prenom }} ET toutes ses {{ nb_operations }} opération(s) ? Action irréversible.');
    }
  </script>
</body>
</html>